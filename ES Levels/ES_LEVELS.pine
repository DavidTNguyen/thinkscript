//@version=6
indicator("ES Levels - Dec 8", overlay=true, max_lines_count=500, max_labels_count=500)

// === ES Update - December 8, 2025 ===
// BIG PICTURE OVERVIEW - Macro structures for context
// (For detailed daily setups/intraday levels: tradecompanionsubstack.com)
//
// CURRENT LEVELS:
// Next resistance: 6893, 6899, 6910
// Support: 6877 (weak now)
// Dip targets: 6868, 6857-59 below
//
// PREVIOUS CONTEXT:
// - Bull flag breakout completed
// - Back-tested successfully at 6805
// - Channel support at 6847 held
//
// TRAJECTORY: 
// Watch 6893, 6899, 6910 resistance cluster
// Support weakening at 6877
// If fails â†’ dip to 6868, then 6857-59 zone
//
// NOTE: We don't predict - we REACT and follow price level to level.

// === ðŸŽ¯ RESISTANCE LEVELS ===
level1 = input.float(6910, "Resistance 3: 6910", group="ðŸŽ¯ Resistance Levels")
level1_thickness = input.int(3, "Line Weight", minval=1, maxval=5, group="ðŸŽ¯ Resistance Levels")
level2 = input.float(6899, "Resistance 2: 6899", group="ðŸŽ¯ Resistance Levels")
level2_thickness = input.int(3, "Line Weight", minval=1, maxval=5, group="ðŸŽ¯ Resistance Levels")
level3 = input.float(6893, "Resistance 1: 6893", group="ðŸŽ¯ Resistance Levels")
level3_thickness = input.int(3, "Line Weight", minval=1, maxval=5, group="ðŸŽ¯ Rally Targets")

// === ðŸŸ¡ SUPPORT WATCH ===
level4 = input.float(6877, "Support: 6877 (WEAK NOW)", group="ðŸŸ¡ Support Watch")
level4_thickness = input.int(2, "Line Weight", minval=1, maxval=5, group="ðŸŸ¡ Support Watch")
level5 = input.float(6868, "Dip Level 1: 6868", group="ðŸŸ¡ Support Watch")
level5_thickness = input.int(2, "Line Weight", minval=1, maxval=5, group="ðŸŸ¡ Support Watch")
level6 = input.float(6859, "Dip Zone: 6857-59", group="ðŸŸ¡ Support Watch")
level6_thickness = input.int(3, "Line Weight", minval=1, maxval=5, group="ðŸŸ¡ Support Watch")

// === ðŸŸ¢ DEEPER SUPPORT LEVELS ===
level7 = input.float(6847, "Prior Support: 6847", group="ðŸŸ¢ Deeper Support")
level7_thickness = input.int(2, "Line Weight", minval=1, maxval=5, group="ðŸŸ¢ Deeper Support")
level8 = input.float(6805, "Back-tested: 6805", group="ðŸŸ¢ Deeper Support")
level8_thickness = input.int(2, "Line Weight", minval=1, maxval=5, group="ðŸŸ¢ Deeper Support")
level9 = input.float(6774, "Downside: 6774", group="ðŸŸ¢ Deeper Support")
level9_thickness = input.int(2, "Line Weight", minval=1, maxval=5, group="ðŸŸ¢ Downside Levels")

// Alert Settings
enableAlerts = input.bool(true, "Enable Alerts", group="Alert Settings")
alertSensitivity = input.float(0.5, "Alert Sensitivity (pts)", minval=0.1, maxval=5.0, group="Alert Settings")
showLabels = input.bool(true, "Show Price Labels", group="Display Settings")
showTable = input.bool(true, "Show Status Table", group="Display Settings")

// === Plot Levels ===
plot(level1, "6910 R3", #FF00FF, level1_thickness, trackprice=false)
plot(level2, "6899 R2", #FF00FF, level2_thickness, trackprice=false)
plot(level3, "6893 R1", #FF00FF, level3_thickness, trackprice=false)
plot(level4, "6877 Support (weak)", #FFFF00, level4_thickness, trackprice=false)
plot(level5, "6868 Dip", #FFA500, level5_thickness, trackprice=false)
plot(level6, "6859 Dip Zone", #FFA500, level6_thickness, trackprice=false)
plot(level7, "6847 Prior", #00FFFF, level7_thickness, trackprice=false)
plot(level8, "6805 Back-test", #00FFFF, level8_thickness, trackprice=false)
plot(level9, "6774 Down", #808080, level9_thickness, trackprice=false)

// === Labels on Last Bar ===
if barstate.islast and showLabels
    var label lbl1 = na
    var label lbl2 = na
    var label lbl3 = na
    var label lbl4 = na
    var label lbl5 = na
    var label lbl6 = na
    var label lbl7 = na
    var label lbl8 = na
    var label lbl9 = na
    
    label.delete(lbl1)
    label.delete(lbl2)
    label.delete(lbl3)
    label.delete(lbl4)
    label.delete(lbl5)
    label.delete(lbl6)
    label.delete(lbl7)
    label.delete(lbl8)
    label.delete(lbl9)
    
    lbl1 := label.new(bar_index + 5, level1, "6910 R3", xloc=xloc.bar_index, yloc=yloc.price, color=color.new(#FF00FF, 80), textcolor=#FF00FF, style=label.style_label_left, size=size.small)
    lbl2 := label.new(bar_index + 5, level2, "6899 R2", xloc=xloc.bar_index, yloc=yloc.price, color=color.new(#FF00FF, 80), textcolor=#FF00FF, style=label.style_label_left, size=size.small)
    lbl3 := label.new(bar_index + 5, level3, "6893 R1", xloc=xloc.bar_index, yloc=yloc.price, color=color.new(#FF00FF, 80), textcolor=#FF00FF, style=label.style_label_left, size=size.small)
    lbl4 := label.new(bar_index + 5, level4, "6877 Weak", xloc=xloc.bar_index, yloc=yloc.price, color=color.new(#FFFF00, 80), textcolor=#FFFF00, style=label.style_label_left, size=size.small)
    lbl5 := label.new(bar_index + 5, level5, "6868 Dip", xloc=xloc.bar_index, yloc=yloc.price, color=color.new(#FFA500, 80), textcolor=#FFA500, style=label.style_label_left, size=size.small)
    lbl6 := label.new(bar_index + 5, level6, "6859 Zone", xloc=xloc.bar_index, yloc=yloc.price, color=color.new(#FFA500, 80), textcolor=#FFA500, style=label.style_label_left, size=size.small)
    lbl7 := label.new(bar_index + 5, level7, "6847 Prior", xloc=xloc.bar_index, yloc=yloc.price, color=color.new(#00FFFF, 80), textcolor=#00FFFF, style=label.style_label_left, size=size.small)
    lbl8 := label.new(bar_index + 5, level8, "6805 Back-test", xloc=xloc.bar_index, yloc=yloc.price, color=color.new(#00FFFF, 80), textcolor=#00FFFF, style=label.style_label_left, size=size.small)
    lbl9 := label.new(bar_index + 5, level9, "6774 Down", xloc=xloc.bar_index, yloc=yloc.price, color=color.new(#808080, 80), textcolor=#808080, style=label.style_label_left, size=size.small)

// === Alert Conditions ===
// Resistance Levels
alertcondition(ta.crossover(close, level1), "ES >> 6910", "ES >> 6910 Resistance 3!")
alertcondition(ta.crossover(close, level2), "ES >> 6899", "ES >> 6899 Resistance 2!")
alertcondition(ta.crossover(close, level3), "ES >> 6893", "ES >> 6893 Resistance 1!")

// Support Watch - WEAK
alertcondition(ta.crossover(close, level4), "ES RECLAIM 6877", "ES >> 6877 - Support reclaim (was weak)")
alertcondition(ta.crossunder(close, level4), "ES LOST 6877", "ES << 6877 - WEAK SUPPORT FAILED!")

// Dip Levels
alertcondition(ta.crossunder(close, level5), "ES DIP 6868", "ES >> 6868 - Dip Level 1")
alertcondition(ta.crossunder(close, level6), "ES DIP ZONE 6859", "ES >> 6857-59 - DIP ZONE")

// Prior Support Reference
alertcondition(ta.crossunder(close, level7), "ES << 6847", "ES << 6847 - Prior channel support lost")

// Deeper Support
alertcondition(ta.crossunder(close, level8), "ES >> 6805", "ES >> 6805 - Back-test level")
alertcondition(ta.crossunder(close, level9), "ES >> 6774", "ES >> 6774 - Deeper downside")

// === Market Structure Status Table ===
var table statusTable = table.new(position.top_right, 2, 10, border_width=1)

if barstate.islast and showTable
    table.cell(statusTable, 0, 0, "ES - Dec 8", text_color=color.white, bgcolor=color.new(color.blue, 50))
    table.cell(statusTable, 1, 0, "Resistance Ahead", text_color=color.fuchsia, bgcolor=color.new(color.blue, 50))
    
    table.cell(statusTable, 0, 1, "Now", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 1, str.tostring(close, "#.00"), text_color=color.aqua, bgcolor=color.new(color.gray, 50))
    
    // Support Status
    supportStatus = close >= level4 ? "6877 HOLDING" : close >= level5 ? "DIP 6868" : "DIP ZONE"
    supportColor = close >= level4 ? color.yellow : close >= level5 ? color.orange : color.red
    
    table.cell(statusTable, 0, 2, "Support", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 2, supportStatus, text_color=supportColor, bgcolor=color.new(color.gray, 50))
    
    // Trade Plan
    tradePlan = close >= level4 ? "R: 6893-99-6910" : close >= level6 ? "WATCH 6857-59" : "DEFEND 6847"
    planColor = close >= level4 ? color.fuchsia : close >= level6 ? color.orange : color.red
    
    table.cell(statusTable, 0, 3, "Plan", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 3, tradePlan, text_color=planColor, bgcolor=color.new(color.gray, 50))
    
    // Support Note
    table.cell(statusTable, 0, 4, "6877 Status", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 4, "WEAK NOW", text_color=color.orange, bgcolor=color.new(color.gray, 50))
    
    // Key Levels Summary
    table.cell(statusTable, 0, 5, "Resistance", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 5, "6893-99-6910", text_color=color.fuchsia, bgcolor=color.new(color.gray, 50))
    
    table.cell(statusTable, 0, 6, "Dip Levels", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 6, "6868, 6857-59", text_color=color.orange, bgcolor=color.new(color.gray, 50))
    
    table.cell(statusTable, 0, 7, "Deeper Sup", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 7, "6847, 6805", text_color=color.aqua, bgcolor=color.new(color.gray, 50))
    
    // Distance to next resistance
    if close < level3
        dist3 = level3 - close
        table.cell(statusTable, 0, 8, "->6893 R1", text_color=color.white, bgcolor=color.new(color.gray, 50))
        table.cell(statusTable, 1, 8, str.tostring(dist3, "#.0") + " pts", text_color=color.fuchsia, bgcolor=color.new(color.gray, 50))
    else
        dist3 = close - level3
        table.cell(statusTable, 0, 8, "Above 6893", text_color=color.white, bgcolor=color.new(color.gray, 50))
        table.cell(statusTable, 1, 8, "+" + str.tostring(dist3, "#.0") + " pts", text_color=color.lime, bgcolor=color.new(color.gray, 50))
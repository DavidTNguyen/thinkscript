//@version=6
indicator("ES Levels", overlay=true, max_lines_count=500, max_labels_count=500)

// === MANCINI ES Levels: Dec 3 - Building MASSIVE FLAG ===
// Updated: December 3, 2025 (6853 HIT!)
// 6830 reclaim â†’ 6835, 6842, 6853 ALL HIT!
// Newsletter readers got lower 6818 Failed Breakdown entry
// Next targets: 6863, 6868, 6877+
// Same supports: 6830, 6825, 6818
// **ALWAYS** take profits level to level!

// === ðŸŽ¯ UPSIDE TARGETS ===
level1 = input.float(6877, "Target 3: 6877+", group="ðŸŽ¯ Upside")
level1_thickness = input.int(2, "Line Weight", minval=1, maxval=5, group="ðŸŽ¯ Upside")
level2 = input.float(6868, "Target 2: 6868", group="ðŸŽ¯ Upside")
level2_thickness = input.int(2, "Line Weight", minval=1, maxval=5, group="ðŸŽ¯ Upside")
level3 = input.float(6863, "Target 1: 6863 (next)", group="ðŸŽ¯ Upside")
level3_thickness = input.int(2, "Line Weight", minval=1, maxval=5, group="ðŸŽ¯ Upside")

// === âœ“ HIT LEVELS (from 6830 reclaim) ===
level4 = input.float(6853, "6853 HIT *", group="âœ“ Hit Levels")
level4_thickness = input.int(1, "Line Weight", minval=1, maxval=5, group="âœ“ Hit Levels")
level5 = input.float(6842, "6842 HIT *", group="âœ“ Hit Levels")
level5_thickness = input.int(1, "Line Weight", minval=1, maxval=5, group="âœ“ Hit Levels")
level6 = input.float(6835, "6835 HIT *", group="âœ“ Hit Levels")
level6_thickness = input.int(1, "Line Weight", minval=1, maxval=5, group="âœ“ Hit Levels")

// === ðŸŸ¢ SUPPORT LEVELS ===
level7 = input.float(6830, "6830 Reclaim (proven!)", group="ðŸŸ¢ Support")
level7_thickness = input.int(3, "Line Weight", minval=1, maxval=5, group="ðŸŸ¢ Support")
level8 = input.float(6825, "6825 Magnet", group="ðŸŸ¢ Support")
level8_thickness = input.int(2, "Line Weight", minval=1, maxval=5, group="ðŸŸ¢ Support")
level9 = input.float(6818, "6818 Failed Breakdown", group="ðŸŸ¢ Support")
level9_thickness = input.int(2, "Line Weight", minval=1, maxval=5, group="ðŸŸ¢ Support")

// Alert Settings
enableAlerts = input.bool(true, "Enable Alerts", group="Alert Settings")
alertSensitivity = input.float(0.5, "Alert Sensitivity (pts)", minval=0.1, maxval=5.0, group="Alert Settings")
showLabels = input.bool(true, "Show Price Labels", group="Display Settings")
showTable = input.bool(true, "Show Status Table", group="Display Settings")

// === Plot Levels ===
plot(level1, "6877 Target", #00FFFF, level1_thickness, trackprice=true)
plot(level2, "6868 Target", #00FFFF, level2_thickness, trackprice=true)
plot(level3, "6863 Next", #00FFFF, level3_thickness, trackprice=true)
plot(level4, "6853 HIT", #808080, level4_thickness, plot.style_linebr, trackprice=true)
plot(level5, "6842 HIT", #808080, level5_thickness, plot.style_linebr, trackprice=true)
plot(level6, "6835 HIT", #808080, level6_thickness, plot.style_linebr, trackprice=true)
plot(level7, "6830 Reclaim", #00FFFF, level7_thickness, trackprice=true)
plot(level8, "6825 Magnet", #FFFF00, level8_thickness, trackprice=true)
plot(level9, "6818 FB", #00FF00, level9_thickness, trackprice=true)

// === Labels on Last Bar ===
if barstate.islast and showLabels
    var label lbl1 = na
    var label lbl2 = na
    var label lbl3 = na
    var label lbl4 = na
    var label lblFlag = na
    var label lbl5 = na
    var label lbl6 = na
    var label lbl7 = na
    
    label.delete(lbl1)
    label.delete(lbl2)
    label.delete(lbl3)
    label.delete(lbl4)
    label.delete(lblFlag)
    label.delete(lbl5)
    label.delete(lbl6)
    label.delete(lbl7)
    
    lbl1 := label.new(bar_index + 5, level1, "R4: 6877+ Runner", xloc=xloc.bar_index, yloc=yloc.abovebar, color=color.new(#00FFFF, 80), textcolor=#00FFFF, style=label.style_label_down, size=size.small)
    lbl2 := label.new(bar_index + 5, level2, "R3: 6868", xloc=xloc.bar_index, yloc=yloc.abovebar, color=color.new(#00FFFF, 80), textcolor=#00FFFF, style=label.style_label_down, size=size.small)
    lbl3 := label.new(bar_index + 5, level3, "R2: 6862 Next", xloc=xloc.bar_index, yloc=yloc.abovebar, color=color.new(#00FFFF, 80), textcolor=#00FFFF, style=label.style_label_down, size=size.small)
    lbl4 := label.new(bar_index + 5, level4, "R1: 6852 HIT âœ“", xloc=xloc.bar_index, yloc=yloc.abovebar, color=color.new(#808080, 80), textcolor=#808080, style=label.style_label_down, size=size.small)
    lblFlag := label.new(bar_index + 5, flagTop, "Flag Top: 6843", xloc=xloc.bar_index, yloc=yloc.abovebar, color=color.new(#FF00FF, 80), textcolor=#FF00FF, style=label.style_label_down, size=size.normal)
// === Alert Conditions ===
// Upside Targets
alertcondition(ta.crossover(close, level1), "ES >> 6877", "ES >> 6877+ \uD83C\uDFAF Extended Target!")
alertcondition(ta.crossover(close, level2), "ES >> 6868", "ES >> 6868 \uD83C\uDFAF Target 2!")
alertcondition(ta.crossover(close, level3), "ES >> 6863", "ES >> 6863 \uD83C\uDFAF Next Target!")

// Hit Levels (from 6830 reclaim)
alertcondition(ta.cross(close, level4), "ES >> 6853", "ES >> 6853 * Target #3 HIT! (All 3 targets from 6830 reclaim!)")
alertcondition(ta.cross(close, level5), "ES >> 6842", "ES >> 6842 * Target #2 HIT!")
alertcondition(ta.cross(close, level6), "ES >> 6835", "ES >> 6835 * Target #1 HIT!")

// Reclaim Level
alertcondition(ta.crossover(close, level7), "ES RECLAIM 6830", "ES >> 6830 RECLAIM - Proven level (hit 6835, 6842, 6853)!")
alertcondition(ta.crossunder(close, level7), "ES LOST 6830", "ES << 6830 - Lost reclaim!")
alertcondition(ta.crossover(close, level5), "ES RECLAIM 6830", "ES >> 6830 RECLAIM - Proven level (hit 6835, 6842)!")
alertcondition(ta.crossunder(close, level5), "ES LOST 6830", "ES << 6830 - Lost reclaim!")

// Magnet Level
alertcondition(ta.cross(close, level6), "ES >> 6825 MAGNET", "ES >> 6825 ðŸ§² MAGNET! (3 day flag building)")
alertcondition(ta.crossunder(close, level6), "ES < 6825", "ES < 6825 - Below magnet!")

// Failed Breakdown Entry
alertcondition(ta.cross(close, level7), "ES >> 6818", "ES >> 6818 - Failed breakdown (newsletter entry)!")
alertcondition(ta.crossunder(close, level7), "ES < 6818", "ES < 6818 - Below newsletter entry!")

// Downside Targets
alertcondition(ta.crossunder(close, level8), "ES >> 6805", "ES >> 6805 - Downside target 1!")
alertcondition(ta.crossunder(close, level9), "ES >> 6796", "ES >> 6796 - Downside target 2!")
alertcondition(ta.crossunder(close, level9), "ES < 6796", "ES < 6796 - Deep dip!")

// === Market Structure Status Table ===
var table statusTable = table.new(position.top_right, 2, 10, border_width=1)

if barstate.islast
    table.cell(statusTable, 0, 0, "MANCINI ES - Dec 3", text_color=color.white, bgcolor=color.new(color.blue, 50))
    table.cell(statusTable, 1, 0, "3 Day Flag Building", text_color=color.yellow, bgcolor=color.new(color.blue, 50))
    
    table.cell(statusTable, 0, 1, "Now", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 1, str.tostring(close, "#.00"), text_color=color.aqua, bgcolor=color.new(color.gray, 50))
    
    // Reclaim Status
    reclaimStatus = close >= level5 ? "6830 RECLAIM âœ“" : "BELOW 6830"
    reclaimColor = close >= level5 ? color.lime : color.red
    
    table.cell(statusTable, 0, 2, "Reclaim", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 2, reclaimStatus, text_color=reclaimColor, bgcolor=color.new(color.gray, 50))
    
    // Trade Plan
    tradePlan = close >= level5 ? "TARGET 6853, 6862+" : "WATCH 6825, 6818"
    planColor = close >= level5 ? color.lime : color.yellow
    
    table.cell(statusTable, 0, 3, "Plan", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 3, tradePlan, text_color=planColor, bgcolor=color.new(color.gray, 50))
    
    // Targets Hit
    table.cell(statusTable, 0, 4, "Targets Hit", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 4, "6835 *, 6842 *", text_color=color.gray, bgcolor=color.new(color.gray, 50))
    
    // Key Levels Summary
    table.cell(statusTable, 0, 5, "Upside", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 5, "6853, 6862+", text_color=color.aqua, bgcolor=color.new(color.gray, 50))
    
    table.cell(statusTable, 0, 6, "Support", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 6, "6830, 6825, 6818", text_color=color.yellow, bgcolor=color.new(color.gray, 50))
    
    table.cell(statusTable, 0, 7, "Downside", text_color=color.white, bgcolor=color.new(color.gray, 50))
    table.cell(statusTable, 1, 7, "6805, 6796", text_color=color.orange, bgcolor=color.new(color.gray, 50))
    
    // Distance to 6830 Reclaim
    if close >= level5
        dist5 = close - level5
        table.cell(statusTable, 0, 8, "6830 Reclaim+", text_color=color.white, bgcolor=color.new(color.gray, 50))
        table.cell(statusTable, 1, 8, "+" + str.tostring(dist5, "#.0") + " pts", text_color=color.lime, bgcolor=color.new(color.gray, 50))
    else
        dist5 = level5 - close
        table.cell(statusTable, 0, 8, "->6830 Reclaim", text_color=color.white, bgcolor=color.new(color.gray, 50))
        table.cell(statusTable, 1, 8, str.tostring(dist5, "#.0") + " pts", text_color=color.yellow, bgcolor=color.new(color.gray, 50))
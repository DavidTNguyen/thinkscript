# === MANCINI ES Levels: ğŸ”º Structure - Support at 6698 ===
# Updated: November 16, 2025
# 
# BIG PICTURE:
# All action since October 10th formed a MASSIVE ğŸ”º (yellow)
# Main structure to watch now
# Support down at 6496, Resistance up at 6874
# We held the Friday breakdown support
#
# THIS WEEK'S SELL:
# ES broke support shelf (white line) at 6845-50
# Key for ğŸ‚ to recover that
#
# PLAN NEXT WEEK:
#
# ğŸ‚ CASE:
# ğŸ‚ hold ğŸ”º support on Friday (rising line, will be 6698 or so Monday)
# Want to continue holding this week
# Resistance at 6874 backed by 6820 (big resistance en route)
# Likely dip there, then need to clear if ğŸ‚ want next leg to 6725-30, 6741, then 7000
# Short-term supports to engage discussed in newsletter but 6674, 6742-38 key
#
# ğŸ» CASE:
# ğŸ”º breakdown = sell to 6638, 6595, 6551
#
# NOTE: Big picture overview for fun to show macro structures
# Has nothing to do with day trading/execution
# For detailed daily setups including all intraday levels, full trading plan,
# entry/exit triggers and comprehensive overview of methodology available at tradecompanion.substack.com

# === RESISTANCE ZONE ===
input level1 = 6874; # R3 - ğŸ”º resistance (top)
input level1_thickness = 5;
input level2 = 6845; # R2 - Broken support shelf (white line) - ğŸ‚ NEED RECLAIM **
input level2_thickness = 5;
input level3 = 6820; # R1 - Big resistance en route
input level3_thickness = 4;

# === ğŸ‚ ğŸ¯ (if 6874 clears) ===
input level4 = 7000; # BT3 - Final ğŸ‚ ğŸ¯
input level4_thickness = 4;
input level5 = 6741; # BT2 - ğŸ‚ ğŸ¯
input level5_thickness = 3;
input level6 = 6725; # BT1 - ğŸ‚ ğŸ¯ (range 6725-30)
input level6_thickness = 3;

# === ğŸ”º STRUCTURE ===
input level7 = 6698; # KEY - ğŸ”º support (rising line, ~6698 Monday) **
input level7_thickness = 5;
input level8 = 6674; # S1 - Short-term support
input level8_thickness = 3;
input level9 = 6642; # S2 - Short-term support (range 6642-38)
input level9_thickness = 3;

# === ğŸ» ğŸ¯ (if ğŸ”º breaks) ===
input level10 = 6638; # BD1 - ğŸ» breakdown ğŸ¯
input level10_thickness = 4;
input level11 = 6595; # BD2 - ğŸ» breakdown ğŸ¯
input level11_thickness = 4;
input level12 = 6551; # BD3 - ğŸ» breakdown ğŸ¯
input level12_thickness = 4;
input level13 = 6496; # BD4 - ğŸ”º support (bottom)
input level13_thickness = 5;

# Alert Settings
input enableAlerts = yes;
input alertSensitivity = 0.5;

# Label Visibility
input showLabels = yes;

# === ANCHORED VWAP SETTINGS ===
input anchorDate = 20251010; # Oct 10, 2025 - ğŸ”º formation start
input anchorDate2 = 20250803; # Aug 3, 2025 - Additional anchor
input showVWAP = yes;

# Fixed bubble logic - show only on last bar
def isLastBar = IsNaN(close[-1]) and !IsNaN(close);

# Day of week detection
def dayOfWeek = GetDayOfWeek(GetYYYYMMDD());
def isMonday = dayOfWeek == 1;
def isFriday = dayOfWeek == 5;

# ğŸ”º position detection
def inTriangle = close >= level7 and close <= level2; # Between 6698-6845
def aboveTriangle = close > level2; # Above 6845
def belowTriangle = close < level7; # Below 6698 (ğŸ”º support)
def nearResistance = close >= level2 - 20 and close <= level2 + 20; # Near 6845

# === ANCHORED VWAP CALCULATION ===
def anchorBar = GetYYYYMMDD() == anchorDate;
def postAnchor = CompoundValue(1, if anchorBar then 1 else if postAnchor[1] then 1 else 0, 0);

def sumTPV = CompoundValue(1, if postAnchor then sumTPV[1] + (high + low + close) / 3 * volume else 0, 0);
def sumVol = CompoundValue(1, if postAnchor then sumVol[1] + volume else 0, 0);
def vwapValue = if sumVol > 0 then sumTPV / sumVol else Double.NaN;

# Second VWAP from Aug 3
def anchorBar2 = GetYYYYMMDD() == anchorDate2;
def postAnchor2 = CompoundValue(1, if anchorBar2 then 1 else if postAnchor2[1] then 1 else 0, 0);

def sumTPV2 = CompoundValue(1, if postAnchor2 then sumTPV2[1] + (high + low + close) / 3 * volume else 0, 0);
def sumVol2 = CompoundValue(1, if postAnchor2 then sumVol2[1] + volume else 0, 0);
def vwapValue2 = if sumVol2 > 0 then sumTPV2 / sumVol2 else Double.NaN;

# === RESISTANCE ZONE ===
plot L1 = level1;
L1.SetDefaultColor(Color.ORANGE);
L1.SetLineWeight(level1_thickness);
L1.SetStyle(Curve.FIRM);

plot L2 = level2;
L2.SetDefaultColor(Color.YELLOW);
L2.SetLineWeight(level2_thickness);
L2.SetStyle(Curve.FIRM);

plot L3 = level3;
L3.SetDefaultColor(Color.LIGHT_ORANGE);
L3.SetLineWeight(level3_thickness);
L3.SetStyle(Curve.FIRM);

# === ğŸ‚ ğŸ¯ ===
plot L4 = level4;
L4.SetDefaultColor(Color.GREEN);
L4.SetLineWeight(level4_thickness);
L4.SetStyle(Curve.FIRM);

plot L5 = level5;
L5.SetDefaultColor(Color.LIGHT_GREEN);
L5.SetLineWeight(level5_thickness);
L5.SetStyle(Curve.FIRM);

plot L6 = level6;
L6.SetDefaultColor(Color.LIGHT_GREEN);
L6.SetLineWeight(level6_thickness);
L6.SetStyle(Curve.SHORT_DASH);

# === ğŸ”º SUPPORT ===
plot L7 = level7;
L7.SetDefaultColor(Color.CYAN);
L7.SetLineWeight(level7_thickness);
L7.SetStyle(Curve.FIRM);

plot L8 = level8;
L8.SetDefaultColor(Color.LIGHT_GRAY);
L8.SetLineWeight(level8_thickness);
L8.SetStyle(Curve.SHORT_DASH);

plot L9 = level9;
L9.SetDefaultColor(Color.LIGHT_GRAY);
L9.SetLineWeight(level9_thickness);
L9.SetStyle(Curve.SHORT_DASH);

# === ğŸ» ğŸ¯ ===
plot L10 = level10;
L10.SetDefaultColor(Color.MAGENTA);
L10.SetLineWeight(level10_thickness);
L10.SetStyle(Curve.FIRM);

plot L11 = level11;
L11.SetDefaultColor(Color.DARK_RED);
L11.SetLineWeight(level11_thickness);
L11.SetStyle(Curve.FIRM);

plot L12 = level12;
L12.SetDefaultColor(Color.RED);
L12.SetLineWeight(level12_thickness);
L12.SetStyle(Curve.FIRM);

plot L13 = level13;
L13.SetDefaultColor(Color.DARK_ORANGE);
L13.SetLineWeight(level13_thickness);
L13.SetStyle(Curve.FIRM);

# === ANCHORED VWAP PLOTS ===
plot VWAP = if showVWAP and postAnchor then vwapValue else Double.NaN;
VWAP.SetDefaultColor(Color.WHITE);
VWAP.SetLineWeight(2);
VWAP.SetStyle(Curve.FIRM);

plot VWAP2 = if showVWAP and postAnchor2 then vwapValue2 else Double.NaN;
VWAP2.SetDefaultColor(Color.MAGENTA);
VWAP2.SetLineWeight(2);
VWAP2.SetStyle(Curve.FIRM);

# Chart bubbles - show only on last bar
AddChartBubble(isLastBar, level1, "R3: 6874 - ğŸ”º Resistance (Top)", Color.ORANGE, yes);
AddChartBubble(isLastBar, level2, "R2: 6845 - BROKEN SUPPORT SHELF - ğŸ‚ NEED RECLAIM **", Color.YELLOW, yes);
AddChartBubble(isLastBar, level3, "R1: 6820 - Big Resistance En Route", Color.LIGHT_ORANGE, yes);
AddChartBubble(isLastBar, level4, "ğŸ¯: 7000 - Final ğŸ‚ ğŸ¯", Color.GREEN, yes);
AddChartBubble(isLastBar, level5, "ğŸ¯: 6741 - ğŸ‚ ğŸ¯", Color.LIGHT_GREEN, yes);
AddChartBubble(isLastBar, level6, "ğŸ¯: 6725-30 - ğŸ‚ ğŸ¯", Color.LIGHT_GREEN, yes);
AddChartBubble(isLastBar, level7, "KEY: 6698 - ğŸ”º Support (Rising Line ~6698 Mon) **", Color.CYAN, yes);
AddChartBubble(isLastBar, level8, "S1: 6674 - Short-term Support", Color.LIGHT_GRAY, no);
AddChartBubble(isLastBar, level9, "S2: 6642-38 - Short-term Support", Color.LIGHT_GRAY, no);
AddChartBubble(isLastBar, level10, "ğŸ¯: 6638 - ğŸ» Breakdown ğŸ¯", Color.MAGENTA, no);
AddChartBubble(isLastBar, level11, "ğŸ¯: 6595 - ğŸ» Breakdown ğŸ¯", Color.DARK_RED, no);
AddChartBubble(isLastBar, level12, "ğŸ¯: 6551 - ğŸ» Breakdown ğŸ¯", Color.RED, no);
AddChartBubble(isLastBar, level13, "ğŸ¯: 6496 - ğŸ”º Support (Bottom)", Color.DARK_ORANGE, no);

# VWAP bubble
AddChartBubble(isLastBar and showVWAP, vwapValue, "VWAP (Oct 10 - ğŸ”º Start)", Color.WHITE, yes);
AddChartBubble(isLastBar and showVWAP, vwapValue2, "VWAP (Aug 3)", Color.MAGENTA, yes);

# === ALERT SYSTEM ===

# CRITICAL: 6845 Broken Support Shelf
Alert(enableAlerts and close crosses above level2, "ES â†‘ 6845 - ğŸ‚ RECLAIM BROKEN SUPPORT SHELF! Test 6874!", Alert.BAR, Sound.Ring);
Alert(enableAlerts and close crosses below level2, "ES â†“ 6845 - Support shelf broken (white line)! Key for ğŸ‚ to recover!", Alert.BAR, Sound.Bell);
Alert(enableAlerts and close >= level2 - alertSensitivity and close <= level2 + alertSensitivity, "ES Testing 6845 - BROKEN SUPPORT SHELF - Critical level!", Alert.BAR, Sound.Chimes);
Alert(enableAlerts and high[1] >= level2 and close < level2 - 10, "ES REJECTION at 6845 - ğŸ‚ failed to reclaim!", Alert.BAR, Sound.Bell);

# ğŸ”º Resistance
Alert(enableAlerts and close crosses above level1, "ES â†‘ 6874 - ğŸ”º RESISTANCE BROKEN! ğŸ‚ ğŸ¯: 6725-30, 6741, 7000!", Alert.BAR, Sound.Ring);
Alert(enableAlerts and close crosses above level3, "ES â†‘ 6820 - Big resistance cleared! Next: 6845, then 6874!", Alert.BAR, Sound.Ring);

# ğŸ‚ ğŸ¯
Alert(enableAlerts and close crosses above level6, "ES â†‘ 6725 - First ğŸ‚ ğŸ¯ zone hit! Next: 6741!", Alert.BAR, Sound.Ring);
Alert(enableAlerts and close crosses above level5, "ES â†‘ 6741 - Second ğŸ‚ ğŸ¯ hit! Next: 7000!", Alert.BAR, Sound.Ring);
Alert(enableAlerts and close crosses above level4, "ES â†‘ 7000 - FINAL ğŸ‚ ğŸ¯ HIT!", Alert.BAR, Sound.Ring);

# CRITICAL: ğŸ”º Support (6698)
Alert(enableAlerts and close crosses below level7, "ES â†“ 6698 - ğŸ”º SUPPORT BROKEN! ğŸ» case active: 6638, 6595, 6551!", Alert.BAR, Sound.Bell);
Alert(enableAlerts and close >= level7 - alertSensitivity and close <= level7 + alertSensitivity, "ES Testing 6698 - ğŸ”º support (rising line ~6698 Monday) - CRITICAL!", Alert.BAR, Sound.Chimes);
Alert(enableAlerts and low[1] <= level7 and close > level7 + 5, "ES BOUNCE from 6698 - ğŸ”º support holds! ğŸ‚ in control!", Alert.BAR, Sound.Ring);
Alert(enableAlerts and isFriday and close >= level7 - 10 and close <= level7 + 10, "FRIDAY: ğŸ”º support test - Key for ğŸ‚ to hold into weekend!", Alert.BAR, Sound.Chimes);

# Short-term Supports
Alert(enableAlerts and close crosses below level8, "ES â†“ 6674 - Short-term support broken! Watch 6642-38!", Alert.BAR, Sound.Bell);
Alert(enableAlerts and close crosses below level9, "ES â†“ 6642 - Short-term support broken! ğŸ”º failure likely!", Alert.BAR, Sound.Bell);
Alert(enableAlerts and low[1] <= level8 and close > level8 + 5, "ES BOUNCE from 6674 - Short-term support holds!", Alert.BAR, Sound.Ring);

# ğŸ» Breakdown ğŸ¯
Alert(enableAlerts and close crosses below level10, "ES â†“ 6638 - FIRST ğŸ» ğŸ¯ HIT! Next: 6595!", Alert.BAR, Sound.Bell);
Alert(enableAlerts and close crosses below level11, "ES â†“ 6595 - SECOND ğŸ» ğŸ¯ HIT! Next: 6551!", Alert.BAR, Sound.Bell);
Alert(enableAlerts and close crosses below level12, "ES â†“ 6551 - THIRD ğŸ» ğŸ¯ HIT! ğŸ”º fully broken!", Alert.BAR, Sound.Bell);
Alert(enableAlerts and close crosses below level13, "ES â†“ 6496 - ğŸ”º BOTTOM BROKEN! Major support failure!", Alert.BAR, Sound.Bell);

# VWAP Alerts
Alert(enableAlerts and showVWAP and close crosses above vwapValue, "ES â†‘ Oct 10 VWAP (ğŸ”º Start)!", Alert.BAR, Sound.Ring);
Alert(enableAlerts and showVWAP and close crosses below vwapValue, "ES â†“ Oct 10 VWAP (ğŸ”º Start)!", Alert.BAR, Sound.Bell);

# Aug 3 VWAP Alerts
Alert(enableAlerts and showVWAP and close crosses above vwapValue2, "ES â†‘ Aug 3 VWAP!", Alert.BAR, Sound.Ring);
Alert(enableAlerts and showVWAP and close crosses below vwapValue2, "ES â†“ Aug 3 VWAP!", Alert.BAR, Sound.Bell);

# Status Labels
AddLabel(showLabels and enableAlerts, "Alerts ON", Color.GREEN);
AddLabel(showLabels and !enableAlerts, "Alerts OFF", Color.RED);
AddLabel(showLabels, "ğŸ”º: Since Oct 10 - Support 6496-6698, Resistance 6874", Color.WHITE);
AddLabel(showLabels, "Now: " + Round(close, 2), Color.CYAN);

# Week Plan Label
AddLabel(showLabels, "Last Week: Broke support shelf 6845-50 - ğŸ‚ need to recover", Color.YELLOW);
AddLabel(showLabels and isMonday, "MONDAY - ğŸ”º support rising line ~6698", Color.ORANGE);
AddLabel(showLabels and isFriday, "FRIDAY - Critical to hold ğŸ”º support into weekend!", Color.MAGENTA);

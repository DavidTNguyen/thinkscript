//@version=6
indicator("SPX JAN 2 - New Year Session", overlay=true, max_lines_count=500, max_labels_count=500)

// === SPX JAN 2 - New Year Session ===
// 
// BIAS:
// Bullish-to-neutral above 6823
// Squeeze setup above 6895
//
// KEY LEVELS:
// Resistance / Squeeze Trigger: 6895 -> 6921 -> 6945
// Support: 6823
// Max Risk Line: 6802
// Failure Targets (only if 6823 breaks): 6759 -> 6719
//
// TRADE SETUPS:
//
// 1. BREAK & HOLD > 6895
//    Buy ATM-+10C
//    Targets: 6921 / 6945
//    Stop: Loss of 6895
//
// 2. RANGE BOUNCE 6823-6895
//    Calls near 6825-6850
//    Scalp to mid-range / VWAP
//    Tight stop below 6823
//
// 3. BREAKDOWN < 6823 (Invalidates Bull Case)
//    Buy ATM--10P
//    Targets: 6759 / 6719
//    Stop: Reclaim of 6823
//
// OPTIONS RULES:
// Size small (0DTE = fast decay)
// Cut losers fast, no averaging
// Trade level confirmation, not prediction
//
// INVALIDATION:
// Sustained trade below 6802 = no longs

// === INPUTS ===
// Upside Targets
level_max = input.float(6999.9, "Double Star ðŸŽ¯", group="Upside Targets")
level0 = input.float(6975, "ðŸŽ¯ [x]", group="Upside Targets")
level0_thickness = input.int(2, "6975 Line Thickness", minval=1, maxval=10, group="Upside Targets")
level1 = input.float(6945, "Upside Target 3", group="Upside Targets")
level1_thickness = input.int(2, "6945 Line Thickness", minval=1, maxval=10, group="Upside Targets")
level2 = input.float(6921, "Upside Target 2", group="Upside Targets")
level2_thickness = input.int(2, "6921 Line Thickness", minval=1, maxval=10, group="Upside Targets")
level3 = input.float(6895, "Squeeze Trigger / Resistance", group="Upside Targets")
level3_thickness = input.int(3, "6895 Line Thickness", minval=1, maxval=10, group="Upside Targets")

// Mid-Range
level4 = input.float(6850, "Mid-Range", group="Mid-Range")
level4_thickness = input.int(1, "6850 Line Thickness", minval=1, maxval=10, group="Mid-Range")

// Key Support
level5 = input.float(6823, "Key Support", group="Support Zone")
level5_thickness = input.int(3, "6823 Line Thickness", minval=1, maxval=10, group="Support Zone")

// Max Risk Line
level6 = input.float(6802, "Max Risk Line", group="Risk Zone")
level6_thickness = input.int(3, "6802 Line Thickness", minval=1, maxval=10, group="Risk Zone")

// Failure Targets
level7 = input.float(6759, "Failure Target 1", group="Failure Targets")
level7_thickness = input.int(2, "6759 Line Thickness", minval=1, maxval=10, group="Failure Targets")
level8 = input.float(6719, "Failure Target 2", group="Failure Targets")
level8_thickness = input.int(2, "6719 Line Thickness", minval=1, maxval=10, group="Failure Targets")

// Extended Levels
level9 = input.float(6700, "Round Number", group="Extended Levels")
level9_thickness = input.int(1, "6700 Line Thickness", minval=1, maxval=10, group="Extended Levels")
level10 = input.float(6680, "Extended Support", group="Extended Levels")
level10_thickness = input.int(1, "6680 Line Thickness", minval=1, maxval=10, group="Extended Levels")
level11 = input.float(6660, "Deep Support", group="Extended Levels")
level11_thickness = input.int(1, "6660 Line Thickness", minval=1, maxval=10, group="Extended Levels")
level12 = input.float(6640, "Deep Support 2", group="Extended Levels")
level12_thickness = input.int(1, "6640 Line Thickness", minval=1, maxval=10, group="Extended Levels")
level13 = input.float(6620, "Extreme Support", group="Extended Levels")
level13_thickness = input.int(1, "6620 Line Thickness", minval=1, maxval=10, group="Extended Levels")
level14 = input.float(6600, "Round Number Extended", group="Extended Levels")
level14_thickness = input.int(1, "6600 Line Thickness", minval=1, maxval=10, group="Extended Levels")

// Key Boundaries
level_squeeze_trigger = input.float(6895, "Squeeze Trigger", group="Key Boundaries")
level_key_support = input.float(6823, "Key Support", group="Key Boundaries")

// Alert Settings
enableAlerts = input.bool(true, "Enable Alerts", group="Alert Settings")
alertSensitivity = input.float(5.0, "Alert Sensitivity", minval=0.1, maxval=10.0, group="Alert Settings")

// Label Visibility
showLabels = input.bool(true, "Show Labels", group="Display Settings")
showLines = input.bool(true, "Show Level Lines", group="Display Settings")
showTable = input.bool(false, "Show Status Table", group="Display Settings")

// === LEVEL LINES ===
var line l_max = na
var line l0 = na
var line l1 = na
var line l2 = na
var line l3 = na
var line l4 = na
var line l5 = na
var line l6 = na
var line l7 = na
var line l8 = na
var line l9 = na
var line l10 = na
var line l11 = na
var line l12 = na
var line l13 = na
var line l14 = na

if showLines and barstate.islast
    // Double Star Target - 6999.9 (Magenta, thick)
    l_max := line.new(bar_index - 100, level_max, bar_index + 20, level_max, color=color.fuchsia, width=3, style=line.style_solid)

    // ðŸŽ¯ Target - 6975 (Magenta)
    l0 := line.new(bar_index - 100, level0, bar_index + 20, level0, color=color.fuchsia, width=level0_thickness, style=line.style_dashed)

    // Upside Target 3 - 6945 (Magenta)
    l1 := line.new(bar_index - 100, level1, bar_index + 20, level1, color=color.fuchsia, width=level1_thickness, style=line.style_dashed)
    
    // Upside Target 2 - 6921 (Magenta)
    l2 := line.new(bar_index - 100, level2, bar_index + 20, level2, color=color.fuchsia, width=level2_thickness, style=line.style_solid)
    
    // Squeeze Trigger - 6895 (Red, thick)
    l3 := line.new(bar_index - 100, level3, bar_index + 20, level3, color=color.red, width=level3_thickness, style=line.style_solid)
    
    // Mid-Range - 6850 (Cyan)
    l4 := line.new(bar_index - 100, level4, bar_index + 20, level4, color=color.aqua, width=level4_thickness, style=line.style_solid)
    
    // Key Support - 6823 (Green, thick)
    l5 := line.new(bar_index - 100, level5, bar_index + 20, level5, color=color.lime, width=level5_thickness, style=line.style_solid)
    
    // Max Risk Line - 6802 (Yellow, thick)
    l6 := line.new(bar_index - 100, level6, bar_index + 20, level6, color=color.yellow, width=level6_thickness, style=line.style_solid)
    
    // Failure Target 1 - 6759 (Red)
    l7 := line.new(bar_index - 100, level7, bar_index + 20, level7, color=color.red, width=level7_thickness, style=line.style_solid)
    
    // Failure Target 2 - 6719 (Red)
    l8 := line.new(bar_index - 100, level8, bar_index + 20, level8, color=color.red, width=level8_thickness, style=line.style_solid)
    
    // Round Number - 6700 (Cyan)
    l9 := line.new(bar_index - 100, level9, bar_index + 20, level9, color=color.aqua, width=level9_thickness, style=line.style_solid)
    
    // Extended Support - 6680 (Cyan)
    l10 := line.new(bar_index - 100, level10, bar_index + 20, level10, color=color.aqua, width=level10_thickness, style=line.style_solid)
    
    // Deep Support - 6660 (Cyan)
    l11 := line.new(bar_index - 100, level11, bar_index + 20, level11, color=color.aqua, width=level11_thickness, style=line.style_solid)
    
    // Deep Support 2 - 6640 (Cyan)
    l12 := line.new(bar_index - 100, level12, bar_index + 20, level12, color=color.aqua, width=level12_thickness, style=line.style_solid)
    
    // Extreme Support - 6620 (Cyan)
    l13 := line.new(bar_index - 100, level13, bar_index + 20, level13, color=color.aqua, width=level13_thickness, style=line.style_solid)
    
    // Round Number Extended - 6600 (Cyan)
    l14 := line.new(bar_index - 100, level14, bar_index + 20, level14, color=color.aqua, width=level14_thickness, style=line.style_dashed)

// === LABELS ===
if barstate.islast and showLabels
    label.new(bar_index + 8, level_max, "6999.9 **", style=label.style_label_left, color=color.fuchsia, textcolor=color.white, size=size.large)
    label.new(bar_index + 8, level0, "6975 ðŸŽ¯", style=label.style_label_left, color=color.fuchsia, textcolor=color.white, size=size.large)
    label.new(bar_index + 8, level1, "6945 Target *", style=label.style_label_left, color=color.fuchsia, textcolor=color.white, size=size.large)
    label.new(bar_index + 8, level2, "6921 Target *", style=label.style_label_left, color=color.fuchsia, textcolor=color.white, size=size.large)
    label.new(bar_index + 8, level3, "6895 Squeeze", style=label.style_label_left, color=color.red, textcolor=color.white, size=size.large)
    label.new(bar_index + 8, level4, "6850 Mid", style=label.style_label_left, color=color.aqua, textcolor=color.black)
    label.new(bar_index + 8, level5, "6823 Support", style=label.style_label_left, color=color.lime, textcolor=color.black, size=size.large)
    label.new(bar_index + 8, level6, "6802 MAX RISK", style=label.style_label_left, color=color.yellow, textcolor=color.black, size=size.large)
    label.new(bar_index + 8, level7, "6759 Fail 1 v", style=label.style_label_left, color=color.red, textcolor=color.white)
    label.new(bar_index + 8, level8, "6719 Fail 2 v", style=label.style_label_left, color=color.red, textcolor=color.white)
    label.new(bar_index + 8, level9, "6700", style=label.style_label_left, color=color.aqua, textcolor=color.black)
    label.new(bar_index + 8, level10, "6680 Extended", style=label.style_label_left, color=color.aqua, textcolor=color.black)
    label.new(bar_index + 8, level11, "6660 Deep", style=label.style_label_left, color=color.aqua, textcolor=color.black)
    label.new(bar_index + 8, level12, "6640 Deep 2", style=label.style_label_left, color=color.aqua, textcolor=color.black)
    label.new(bar_index + 8, level13, "6620 Extreme", style=label.style_label_left, color=color.aqua, textcolor=color.black)
    label.new(bar_index + 8, level14, "6600", style=label.style_label_left, color=color.aqua, textcolor=color.black)

// === POSITION DETECTION ===
aboveMax = close > level_max
atMax = close >= level_max - 5 and close <= level_max + 5
above6975 = close > level0  // ðŸŽ¯ Target
at6975 = close >= level0 - 5 and close <= level0 + 5
above6945 = close > level1  // Upside Target 3
at6945 = close >= level1 - 5 and close <= level1 + 5
above6921 = close > level2  // Upside Target 2
at6921 = close >= level2 - 5 and close <= level2 + 5
above6895 = close > level3  // Squeeze Trigger
at6895 = close >= level3 - 5 and close <= level3 + 5
above6850 = close > level4  // Mid-Range
at6850 = close >= level4 - 5 and close <= level4 + 5
above6823 = close > level5  // Key Support
at6823 = close >= level5 - 5 and close <= level5 + 5
above6802 = close > level6  // Max Risk Line
at6802 = close >= level6 - 5 and close <= level6 + 5
below6802 = close < level6
above6759 = close > level7  // Failure Target 1
at6759 = close >= level7 - 5 and close <= level7 + 5
above6719 = close > level8  // Failure Target 2
at6719 = close >= level8 - 5 and close <= level8 + 5
above6700 = close > level9  // Round Number
at6700 = close >= level9 - 5 and close <= level9 + 5
above6680 = close > level10 // Extended Support
at6680 = close >= level10 - 5 and close <= level10 + 5
below6680 = close < level10
above6660 = close > level11 // Deep Support
at6660 = close >= level11 - 5 and close <= level11 + 5
above6640 = close > level12 // Deep Support 2
at6640 = close >= level12 - 5 and close <= level12 + 5
above6620 = close > level13 // Extreme Support
at6620 = close >= level13 - 5 and close <= level13 + 5
above6600 = close > level14 // Round Number Extended
at6600 = close >= level14 - 5 and close <= level14 + 5
below6600 = close < level14

// Zone detection
inSqueezeRange = close >= level5 and close <= level3    // 6823-6895 trading range
inMaxRiskZone = close >= level6 and close <= level5     // 6802-6823 caution zone
aboveSqueezeTrigger = close > level3                    // Above 6895
belowMaxRisk = close < level6                           // Below 6802

// Volume spike detection
volSpike = volume > ta.sma(volume, 20) * 1.5

// === ALERT CONDITIONS ===

// DOUBLE STAR (6999.9)
alertcondition(ta.crossover(close, level_max), "6999.9 DOUBLE STAR", "SPX >> 6999.9 - DOUBLE STAR HIT!")
alertcondition(atMax, "At 6999.9", "SPX at 6999.9 - Double Star!")

// UPSIDE TARGET 3 (6945)
alertcondition(ta.crossover(close, level1), "6945 TARGET 3", "SPX >> 6945 - TARGET 3 HIT!")
alertcondition(at6945, "At 6945", "SPX at 6945 - Final target!")

// UPSIDE TARGET 2 (6921)
alertcondition(ta.crossover(close, level2), "6921 TARGET 2 UP", "SPX UP 6921 - TARGET 2 HIT!")
alertcondition(ta.crossunder(close, level2), "6921 TARGET 2 DOWN", "SPX DOWN 6921 - Back below target 2!")
alertcondition(at6921, "At 6921", "SPX at 6921 - Target 2!")

// SQUEEZE TRIGGER (6895)
alertcondition(ta.crossover(close, level3), "6895 SQUEEZE UP", "SPX UP 6895 SQUEEZE TRIGGER! BREAKOUT LONG!")
alertcondition(ta.crossunder(close, level3), "6895 SQUEEZE DOWN", "SPX DOWN 6895 Lost squeeze trigger!")
alertcondition(at6895, "At 6895", "SPX at 6895 Squeeze trigger level!")
alertcondition(aboveSqueezeTrigger, "Above Squeeze", "SPX > 6895 - SQUEEZE MODE! Target 6921/6945!")

// MID-RANGE (6850)
alertcondition(ta.crossover(close, level4), "6850 MID UP", "SPX >> 6850 - Mid-range / VWAP area!")
alertcondition(ta.crossunder(close, level4), "6850 MID DOWN", "SPX << 6850 - Below mid-range!")

// KEY SUPPORT (6823)
alertcondition(ta.crossover(close, level5), "6823 SUPPORT UP", "SPX UP 6823 Holding key support!")
alertcondition(ta.crossunder(close, level5), "6823 SUPPORT DOWN", "SPX DOWN 6823 LOST SUPPORT! BULL CASE INVALID!")
alertcondition(at6823, "At 6823 Support", "SPX at 6823 Key support!")
alertcondition(inSqueezeRange, "In Squeeze Range", "SPX in RANGE (6823-6895) - Calls near support!")

// MAX RISK LINE (6802)
alertcondition(ta.crossover(close, level6), "6802 MAX RISK UP", "SPX UP 6802 Back above max risk!")
alertcondition(ta.crossunder(close, level6), "6802 MAX RISK DOWN", "SPX DOWN 6802 MAX RISK LINE! NO LONGS!")
alertcondition(at6802, "At 6802 Max Risk", "SPX at 6802 Max risk line!")
alertcondition(inMaxRiskZone, "In Max Risk Zone", "SPX in CAUTION ZONE (6802-6823)!")
alertcondition(belowMaxRisk, "Below Max Risk", "SPX < 6802 BELOW MAX RISK - NO LONGS!")

// FAILURE TARGET 1 (6759)
alertcondition(ta.crossunder(close, level7), "6759 FAIL 1", "SPX >> 6759 FAILURE TARGET 1!")
alertcondition(at6759, "At 6759", "SPX at 6759 - Put target 1!")

// FAILURE TARGET 2 (6719)
alertcondition(ta.crossunder(close, level8), "6719 FAIL 2", "SPX >> 6719 FAILURE TARGET 2!")
alertcondition(at6719, "At 6719", "SPX at 6719 - Put target 2!")

// ROUND NUMBER (6700)
alertcondition(ta.crossunder(close, level9), "6700 ROUND", "SPX >> 6700 - Round number!")

// EXTENDED SUPPORT (6680)
alertcondition(ta.crossover(close, level10), "6680 BOUNCE", "SPX UP 6680 - Bounce from extended!")
alertcondition(ta.crossunder(close, level10), "6680 BREACH", "SPX DOWN 6680 - Below extended support!")
alertcondition(at6680, "At 6680", "SPX at 6680 - Extended support!")

// DEEP SUPPORT (6660)
alertcondition(ta.crossunder(close, level11), "6660 DEEP", "SPX >> 6660 - Deep support!")

// DEEP SUPPORT 2 (6640)
alertcondition(ta.crossunder(close, level12), "6640 DEEP 2", "SPX >> 6640 - Deep support 2!")

// EXTREME SUPPORT (6620)
alertcondition(ta.crossunder(close, level13), "6620 EXTREME", "SPX >> 6620 - Extreme support!")

// ROUND NUMBER EXTENDED (6600)
alertcondition(ta.crossunder(close, level14), "6600 EXTENDED", "SPX >> 6600 - Round number extended!")
alertcondition(at6600, "At 6600", "SPX at 6600 - Round number extended!")
alertcondition(below6600, "Below 6600", "SPX < 6600 - Below round number extended!")

// === STATUS TABLE ===
var table statusTable = table.new(position.top_right, 2, 20, border_width=1)

if barstate.islast and showLabels and showTable
    // Header
    table.cell(statusTable, 0, 0, "SPX JAN 2", bgcolor=color.new(color.fuchsia, 70), text_color=color.white)
    table.cell(statusTable, 1, 0, str.tostring(close, "#.##"), bgcolor=color.new(color.fuchsia, 70), text_color=color.white)
    
    // Alert Status
    table.cell(statusTable, 0, 1, "Alerts", text_color=color.white)
    table.cell(statusTable, 1, 1, enableAlerts ? "ON" : "OFF", bgcolor=enableAlerts ? color.green : color.red, text_color=color.white)
    
    // Bias based on positioning
    bias = aboveSqueezeTrigger ? "SQUEEZE MODE" : inSqueezeRange ? "RANGE" : inMaxRiskZone ? "CAUTION" : belowMaxRisk ? "NO LONGS" : "NEUTRAL"
    biasColor = aboveSqueezeTrigger ? color.green : inSqueezeRange ? color.blue : inMaxRiskZone ? color.orange : belowMaxRisk ? color.red : color.yellow
    table.cell(statusTable, 0, 2, "Bias", text_color=color.white)
    table.cell(statusTable, 1, 2, bias, bgcolor=color.new(biasColor, 70), text_color=color.white)
    
    // Position Status
    position = above6945 ? "Above Target 3" : above6921 ? "Above Target 2" : above6895 ? "Squeeze Mode" : above6823 ? "In Range" : above6802 ? "Caution Zone" : above6759 ? "Below Max Risk" : above6719 ? "Fail Target 1" : "Extended Down"
    posColor = above6895 ? color.lime : above6823 ? color.blue : above6802 ? color.orange : color.red
    table.cell(statusTable, 0, 3, "Position", text_color=color.white)
    table.cell(statusTable, 1, 3, position, bgcolor=color.new(posColor, 70), text_color=color.white)
    
    // Strategy
    strategy = aboveSqueezeTrigger ? "Long to 6921/6945" : inSqueezeRange ? "Calls near 6823" : inMaxRiskZone ? "Tight stops" : belowMaxRisk ? "Puts to 6759/6719" : "Wait for setup"
    table.cell(statusTable, 0, 4, "Strategy", text_color=color.white)
    table.cell(statusTable, 1, 4, strategy, bgcolor=color.new(color.blue, 80), text_color=color.white)
    
    // Key Levels
    table.cell(statusTable, 0, 5, "Squeeze Trigger", text_color=color.white)
    table.cell(statusTable, 1, 5, "6895", bgcolor=color.new(color.red, 80), text_color=color.white)
    
    table.cell(statusTable, 0, 6, "Key Support", text_color=color.white)
    table.cell(statusTable, 1, 6, "6823", bgcolor=color.new(color.lime, 80), text_color=color.black)
    
    table.cell(statusTable, 0, 7, "Max Risk", text_color=color.white)
    table.cell(statusTable, 1, 7, "6802", bgcolor=color.new(color.yellow, 80), text_color=color.black)
    
    table.cell(statusTable, 0, 8, "Fail Targets", text_color=color.white)
    table.cell(statusTable, 1, 8, "6759 / 6719", bgcolor=color.new(color.red, 80), text_color=color.white)
    
    // Distance to key levels
    distToSqueeze = level3 - close
    distToSqueezeStr = distToSqueeze > 0 ? "-" + str.tostring(math.abs(distToSqueeze), "#.#") : "+" + str.tostring(math.abs(distToSqueeze), "#.#")
    table.cell(statusTable, 0, 9, "To Squeeze 6895", text_color=color.white)
    table.cell(statusTable, 1, 9, distToSqueezeStr, bgcolor=color.new(color.red, 80), text_color=color.white)
    
    distToSupport = level5 - close
    distToSupportStr = distToSupport > 0 ? "-" + str.tostring(math.abs(distToSupport), "#.#") : "+" + str.tostring(math.abs(distToSupport), "#.#")
    table.cell(statusTable, 0, 10, "To Support 6823", text_color=color.white)
    table.cell(statusTable, 1, 10, distToSupportStr, bgcolor=color.new(color.lime, 80), text_color=color.black)
    
    distToMaxRisk = level6 - close
    distToMaxRiskStr = distToMaxRisk > 0 ? "-" + str.tostring(math.abs(distToMaxRisk), "#.#") : "+" + str.tostring(math.abs(distToMaxRisk), "#.#")
    table.cell(statusTable, 0, 11, "To Max Risk 6802", text_color=color.white)
    table.cell(statusTable, 1, 11, distToMaxRiskStr, bgcolor=color.new(color.yellow, 80), text_color=color.black)
    
    // Volume Status
    volStatus = volSpike ? "SPIKE" : "Normal"
    volColor = volSpike ? color.orange : color.gray
    table.cell(statusTable, 0, 12, "Volume", text_color=color.white)
    table.cell(statusTable, 1, 12, volStatus, bgcolor=color.new(volColor, 70), text_color=color.white)
    
    // Trade Setups
    table.cell(statusTable, 0, 13, "Setup 1", text_color=color.white)
    table.cell(statusTable, 1, 13, ">6895: Long 6921/6945", bgcolor=color.new(color.lime, 80), text_color=color.black)
    
    table.cell(statusTable, 0, 14, "Setup 2", text_color=color.white)
    table.cell(statusTable, 1, 14, "6823-6895: Range", bgcolor=color.new(color.blue, 80), text_color=color.white)
    
    table.cell(statusTable, 0, 15, "Setup 3", text_color=color.white)
    table.cell(statusTable, 1, 15, "<6823: Puts 6759/6719", bgcolor=color.new(color.red, 80), text_color=color.white)
    
    table.cell(statusTable, 0, 16, "Invalidation", text_color=color.white)
    table.cell(statusTable, 1, 16, "<6802 = NO LONGS", bgcolor=color.new(color.yellow, 80), text_color=color.black)

// === PLOT INVISIBLE LINES FOR ALERT TRIGGERS ===
plot(level_max, "6999.9 Double Star", color=color.new(color.fuchsia, 100))
plot(level1, "6945 Target 3", color=color.new(color.fuchsia, 100))
plot(level2, "6921 Target 2", color=color.new(color.fuchsia, 100))
plot(level3, "6895 Squeeze", color=color.new(color.red, 100))
plot(level4, "6850 Mid", color=color.new(color.aqua, 100))
plot(level5, "6823 Support", color=color.new(color.lime, 100))
plot(level6, "6802 Max Risk", color=color.new(color.yellow, 100))
plot(level7, "6759 Fail 1", color=color.new(color.red, 100))
plot(level8, "6719 Fail 2", color=color.new(color.red, 100))
plot(level9, "6700 Round", color=color.new(color.aqua, 100))
plot(level10, "6680 Extended", color=color.new(color.aqua, 100))
plot(level11, "6660 Deep", color=color.new(color.aqua, 100))
plot(level12, "6640 Deep 2", color=color.new(color.aqua, 100))
plot(level13, "6620 Extreme", color=color.new(color.aqua, 100))
plot(level14, "6600 Round Ext", color=color.new(color.aqua, 100))

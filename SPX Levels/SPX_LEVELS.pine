//@version=6
indicator("SPX DEC 22 - IC WHALE WEEK", overlay=true, max_lines_count=500, max_labels_count=500)

// === SPX DEC 22 - Holiday Week IC Whale Setup ===
// 
// MARKET CONTEXT:
// Friday close: 6835 (~1% below ATH)
// Holiday-shortened week, LOW VOLUME
// VIX/VVIX at yearly lows
// VIX9D implies ~43-45 pt daily move
// Theta burn = primary theme this 3.5-day week
//
// üêã IC WHALE POSITIONING (15k contracts, may go 50k by Wed):
// CALL CREDIT SPREAD: 6860/6865 CCS (short calls)
// PUT CREDIT SPREAD: 6795/6800 PCS (short puts)
// THE TRAP: If price pushes through strikes, whale doubles/triples size Tue
// INFLECTION: Wednesday = critical pin day (could reach 50k contracts)
//
// CHOP ZONE: 6835-6875
//
// UPSIDE SCENARIOS:
// Above 6850 -> Stall at 6860 (IC Whale short call / sticky GEX)
// Above 6865 -> Push to 6875 (top of chop)
// Above 6885 -> BREAKOUT - Battle for 6900 ATH begins
// Thin liquidity = algos can weaponize gamma for quick ramp
//
// DOWNSIDE SCENARIOS:
// Below 6850 -> Retest 6835 Friday close
// Below 6835 -> Reaction zone 6820
// Below 6815 -> THE FLOOR - Watch for 6800
// 6800 = Major gamma glob / IC Whale short put / V-BOUNCE zone üîÑ
//
// ECONOMIC CALENDAR:
// Mon 8:30 AM - PCE Price Index (Fed's preferred inflation metric)
// Tue 8:30 AM - GDP Final, Durable Goods; 10 AM - Consumer Confidence
// Wed - HALF DAY (close 1 PM ET)
// Thu - CLOSED (Christmas)

// === INPUTS ===
// Upside Targets
level1 = input.float(6900, "ATH Target üéØ", group="üéØ Upside Targets")
level1_thickness = input.int(2, "6900 Line Thickness", minval=1, maxval=10, group="üéØ Upside Targets")
level2 = input.float(6885, "Breakout Trigger", group="üéØ Upside Targets")
level2_thickness = input.int(3, "6885 Line Thickness", minval=1, maxval=10, group="üéØ Upside Targets")
level3 = input.float(6875, "Chop Zone Top", group="üéØ Upside Targets")
level3_thickness = input.int(2, "6875 Line Thickness", minval=1, maxval=10, group="üéØ Upside Targets")

// IC Whale Zone
level4 = input.float(6865, "üêã IC Whale CCS Short Call", group="üêã IC Whale Zone")
level4_thickness = input.int(4, "6865 Line Thickness", minval=1, maxval=10, group="üêã IC Whale Zone")
level5 = input.float(6860, "Sticky GEX / Stall", group="üêã IC Whale Zone")
level5_thickness = input.int(2, "6860 Line Thickness", minval=1, maxval=10, group="üêã IC Whale Zone")
level6 = input.float(6850, "Pivot", group="üêã IC Whale Zone")
level6_thickness = input.int(2, "6850 Line Thickness", minval=1, maxval=10, group="üêã IC Whale Zone")

// Chop Zone / Support
level7 = input.float(6835, "Friday Close", group="‚ö° Chop Zone (6835-6875)")
level7_thickness = input.int(3, "6835 Line Thickness", minval=1, maxval=10, group="‚ö° Chop Zone (6835-6875)")
level8 = input.float(6820, "Reaction Zone", group="‚ö° Chop Zone (6835-6875)")
level8_thickness = input.int(2, "6820 Line Thickness", minval=1, maxval=10, group="‚ö° Chop Zone (6835-6875)")
level9 = input.float(6815, "The Floor ‚ö†Ô∏è", group="‚ö° Chop Zone (6835-6875)")
level9_thickness = input.int(2, "6815 Line Thickness", minval=1, maxval=10, group="‚ö° Chop Zone (6835-6875)")
level10 = input.float(6800, "üêã IC Whale PCS / V-Bounce üîÑ", group="‚ö° Chop Zone (6835-6875)")
level10_thickness = input.int(4, "6800 Line Thickness", minval=1, maxval=10, group="‚ö° Chop Zone (6835-6875)")

// IC Whale Spread Strikes
level_whale_call = input.float(6865, "CCS Short Strike", group="üêã IC Whale Spreads")
level_whale_put = input.float(6800, "PCS Short Strike", group="üêã IC Whale Spreads")
level_whale_put_long = input.float(6795, "PCS Long Strike", group="üêã IC Whale Spreads")

// Alert Settings
enableAlerts = input.bool(true, "Enable Alerts", group="üîî Alert Settings")
alertSensitivity = input.float(5.0, "Alert Sensitivity", minval=0.1, maxval=10.0, group="üîî Alert Settings")

// Label Visibility
showLabels = input.bool(true, "Show Labels", group="üìä Display Settings")
showLines = input.bool(true, "Show Level Lines", group="üìä Display Settings")
showTable = input.bool(true, "Show Status Table", group="üìä Display Settings")

// === LEVEL LINES ===
var line l1 = na
var line l2 = na
var line l3 = na
var line l4 = na
var line l5 = na
var line l6 = na
var line l7 = na
var line l8 = na
var line l9 = na
var line l10 = na
var line l_whale_call = na
var line l_whale_put = na
var line l_whale_put_long = na

if showLines and barstate.islast
    // ATH Target - 6900 (Green)
    l1 := line.new(bar_index - 100, level1, bar_index + 20, level1, color=color.lime, width=level1_thickness, style=line.style_solid)
    
    // Breakout Trigger - 6885 (Green)
    l2 := line.new(bar_index - 100, level2, bar_index + 20, level2, color=color.lime, width=level2_thickness, style=line.style_solid)
    
    // Chop Zone Top - 6875 (Cyan)
    l3 := line.new(bar_index - 100, level3, bar_index + 20, level3, color=color.aqua, width=level3_thickness, style=line.style_solid)
    
    // IC Whale CCS - 6865 (Magenta, thick)
    l4 := line.new(bar_index - 100, level4, bar_index + 20, level4, color=color.fuchsia, width=level4_thickness, style=line.style_solid)
    
    // Sticky GEX - 6860 (Yellow)
    l5 := line.new(bar_index - 100, level5, bar_index + 20, level5, color=color.yellow, width=level5_thickness, style=line.style_solid)
    
    // Pivot - 6850 (Cyan)
    l6 := line.new(bar_index - 100, level6, bar_index + 20, level6, color=color.aqua, width=level6_thickness, style=line.style_solid)
    
    // Friday Close - 6835 (Yellow, thick)
    l7 := line.new(bar_index - 100, level7, bar_index + 20, level7, color=color.yellow, width=level7_thickness, style=line.style_solid)
    
    // Reaction Zone - 6820 (Orange)
    l8 := line.new(bar_index - 100, level8, bar_index + 20, level8, color=color.orange, width=level8_thickness, style=line.style_solid)
    
    // The Floor - 6815 (Orange)
    l9 := line.new(bar_index - 100, level9, bar_index + 20, level9, color=color.orange, width=level9_thickness, style=line.style_solid)
    
    // IC Whale PCS - 6800 (Magenta, thick)
    l10 := line.new(bar_index - 100, level10, bar_index + 20, level10, color=color.fuchsia, width=level10_thickness, style=line.style_solid)
    
    // IC Whale Spread Strikes
    l_whale_put_long := line.new(bar_index - 100, level_whale_put_long, bar_index + 20, level_whale_put_long, color=color.maroon, width=1, style=line.style_dashed)

// === LABELS ===
if barstate.islast and showLabels
    label.new(bar_index + 8, level1, "6900 ATH üéØ", style=label.style_label_left, color=color.lime, textcolor=color.black)
    label.new(bar_index + 8, level2, "6885 BO", style=label.style_label_left, color=color.lime, textcolor=color.black)
    label.new(bar_index + 8, level3, "6875 Chop Top", style=label.style_label_left, color=color.aqua, textcolor=color.black)
    label.new(bar_index + 8, level4, "6865 üêã CCS", style=label.style_label_left, color=color.fuchsia, textcolor=color.white, size=size.large)
    label.new(bar_index + 8, level5, "6860 GEX", style=label.style_label_left, color=color.yellow, textcolor=color.black)
    label.new(bar_index + 8, level6, "6850 Pivot", style=label.style_label_left, color=color.aqua, textcolor=color.black)
    label.new(bar_index + 8, level7, "6835 Fri Close", style=label.style_label_left, color=color.yellow, textcolor=color.black, size=size.large)
    label.new(bar_index + 8, level8, "6820 React", style=label.style_label_left, color=color.orange, textcolor=color.white)
    label.new(bar_index + 8, level9, "6815 Floor ‚ö†Ô∏è", style=label.style_label_left, color=color.orange, textcolor=color.white)
    label.new(bar_index + 8, level10, "6800 üêã PCS V-Bounce", style=label.style_label_left, color=color.fuchsia, textcolor=color.white, size=size.large)
    
    // IC Whale Spread Labels
    label.new(bar_index + 8, level_whale_put_long, "6795 üêã PCS Long", style=label.style_label_left, color=color.maroon, textcolor=color.white)

// === POSITION DETECTION ===
above6900 = close > level1  // ATH Target
at6900 = close >= level1 - 5 and close <= level1 + 5
above6885 = close > level2  // BREAKOUT TRIGGER
at6885 = close >= level2 - 5 and close <= level2 + 5
above6875 = close > level3  // Chop Zone Top
at6875 = close >= level3 - 5 and close <= level3 + 5
above6865 = close > level4  // IC WHALE CCS
at6865 = close >= level4 - 5 and close <= level4 + 5
above6860 = close > level5  // Sticky GEX
at6860 = close >= level5 - 5 and close <= level5 + 5
above6850 = close > level6  // Pivot
at6850 = close >= level6 - 5 and close <= level6 + 5
above6835 = close > level7  // Friday Close
at6835 = close >= level7 - 5 and close <= level7 + 5
below6835 = close < level7
above6820 = close > level8  // Reaction Zone
at6820 = close >= level8 - 5 and close <= level8 + 5
above6815 = close > level9  // The Floor
at6815 = close >= level9 - 5 and close <= level9 + 5
above6800 = close > level10 // Gamma Glob / IC Whale PCS
at6800 = close >= level10 - 5 and close <= level10 + 5
below6800 = close < level10
inChopZone = close >= level7 and close <= level3  // 6835-6875 chop zone
inWhaleZone = close >= level10 and close <= level4  // 6800-6865 IC Whale range

// Volume spike detection
volSpike = volume > ta.sma(volume, 20) * 1.5

// === ALERT CONDITIONS ===

// ATH TARGET
alertcondition(ta.crossover(close, level1), "6900 ATH TARGET", "SPX >> 6900 üéØ ATH TARGET!")
alertcondition(at6900, "At 6900", "SPX at 6900 - All-Time High battle!")

// BREAKOUT TRIGGER
alertcondition(ta.crossover(close, level2), "6885 BREAKOUT", "SPX UP 6885 ‚ñ≤ BREAKOUT! Battle for 6900 ATH begins!")
alertcondition(ta.crossunder(close, level2), "6885 REJECT", "SPX DOWN 6885 - Breakout rejected!")
alertcondition(at6885, "At 6885", "SPX at 6885 - Breakout trigger!")

// CHOP ZONE TOP
alertcondition(ta.crossover(close, level3), "6875 CHOP TOP", "SPX >> 6875 - Chop zone top!")
alertcondition(inChopZone, "In Chop Zone", "SPX in CHOP ZONE (6835-6875) - Range bound!")

// IC WHALE CCS (6865)
alertcondition(ta.crossover(close, level4), "6865 WHALE CCS UP", "SPX UP 6865 üêã Above IC Whale CCS strike!")
alertcondition(ta.crossunder(close, level4), "6865 WHALE CCS DOWN", "SPX DOWN 6865 üêã IC Whale CCS strike - Expect stall!")
alertcondition(at6865, "At 6865 Whale", "SPX at 6865 üêã IC Whale short call strike!")

// STICKY GEX
alertcondition(ta.crossover(close, level5), "6860 GEX", "SPX >> 6860 - Sticky GEX / Stall area!")
alertcondition(ta.crossunder(close, level5), "6860 GEX DOWN", "SPX << 6860 - Below sticky GEX!")

// PIVOT
alertcondition(ta.crossover(close, level6), "6850 PIVOT UP", "SPX >> 6850 - Pivot level!")
alertcondition(ta.crossunder(close, level6), "6850 PIVOT DOWN", "SPX << 6850 - Below pivot!")

// FRIDAY CLOSE
alertcondition(ta.crossover(close, level7), "6835 RECLAIM", "SPX UP 6835 - Reclaiming Friday close!")
alertcondition(ta.crossunder(close, level7), "6835 LOST", "SPX DOWN 6835 - Below Friday close!")
alertcondition(at6835, "At 6835", "SPX at 6835 - Friday close!")

// REACTION ZONE
alertcondition(ta.crossunder(close, level8), "6820 REACTION", "SPX >> 6820 - Reaction zone!")

// THE FLOOR
alertcondition(ta.crossunder(close, level9), "6815 FLOOR", "SPX >> 6815 ‚ö†Ô∏è THE FLOOR - Watch for 6800!")

// IC WHALE PCS / GAMMA GLOB (6800)
alertcondition(ta.crossover(close, level10), "6800 V-BOUNCE", "SPX UP 6800 üêã V-BOUNCE from IC Whale PCS / Gamma Glob!")
alertcondition(ta.crossunder(close, level10), "6800 BREACH", "SPX DOWN 6800 üêã IC Whale PCS strike breached!")
alertcondition(at6800, "At 6800 Whale", "SPX at 6800 üêã Major Gamma Glob / IC Whale short put!")
alertcondition(below6800, "Below 6800", "SPX < 6800 - Below IC Whale range!")

// IC WHALE ZONE ALERT
alertcondition(inWhaleZone, "In Whale Zone", "SPX in IC WHALE ZONE (6800-6865) - Watch for pin!")

// === STATUS TABLE ===
var table statusTable = table.new(position.top_right, 2, 20, border_width=1)

if barstate.islast and showLabels and showTable
    // Header
    table.cell(statusTable, 0, 0, "SPX DEC 22 üêã", bgcolor=color.new(color.fuchsia, 70), text_color=color.white)
    table.cell(statusTable, 1, 0, str.tostring(close, "#.##"), bgcolor=color.new(color.fuchsia, 70), text_color=color.white)
    
    // Alert Status
    table.cell(statusTable, 0, 1, "Alerts", text_color=color.white)
    table.cell(statusTable, 1, 1, enableAlerts ? "ON" : "OFF", bgcolor=enableAlerts ? color.green : color.red, text_color=color.white)
    
    // Bias based on IC Whale positioning
    bias = above6885 ? "üìà BREAKOUT" : inChopZone ? "‚ö° CHOP ZONE" : inWhaleZone ? "üêã WHALE ZONE" : below6800 ? "üìâ BREAKDOWN" : "üìç NEUTRAL"
    biasColor = above6885 ? color.green : inChopZone ? color.purple : inWhaleZone ? color.fuchsia : below6800 ? color.red : color.yellow
    table.cell(statusTable, 0, 2, "Bias", text_color=color.white)
    table.cell(statusTable, 1, 2, bias, bgcolor=color.new(biasColor, 70), text_color=color.white)
    
    // Position Status
    position = above6900 ? "‚Üë ATH!" : above6885 ? "Above BO" : above6875 ? "Chop Top" : above6865 ? "Above üêãCCS" : above6860 ? "At GEX" : above6850 ? "Pivot" : above6835 ? "Above Fri" : above6820 ? "Below Fri" : above6815 ? "React Zone" : above6800 ? "At Floor" : "Below üêãPCS"
    posColor = above6900 ? color.lime : above6885 ? color.lime : above6865 ? color.fuchsia : above6835 ? color.yellow : above6800 ? color.orange : color.red
    table.cell(statusTable, 0, 3, "Position", text_color=color.white)
    table.cell(statusTable, 1, 3, position, bgcolor=color.new(posColor, 70), text_color=color.white)
    
    // Strategy
    strategy = above6885 ? "Battle for 6900 ATH" : inChopZone ? "Range 6835-6875" : above6800 ? "Watch 6800 V-bounce" : "Below IC Whale range"
    table.cell(statusTable, 0, 4, "Strategy", text_color=color.white)
    table.cell(statusTable, 1, 4, strategy, bgcolor=color.new(color.blue, 80), text_color=color.white)
    
    // IC Whale Levels
    table.cell(statusTable, 0, 5, "üêã CCS Strike", text_color=color.white)
    table.cell(statusTable, 1, 5, "6865", bgcolor=color.new(color.fuchsia, 80), text_color=color.white)
    
    table.cell(statusTable, 0, 6, "üêã PCS Strike", text_color=color.white)
    table.cell(statusTable, 1, 6, "6800", bgcolor=color.new(color.fuchsia, 80), text_color=color.white)
    
    table.cell(statusTable, 0, 7, "Chop Zone", text_color=color.white)
    table.cell(statusTable, 1, 7, "6835-6875", bgcolor=color.new(color.purple, 80), text_color=color.white)
    
    table.cell(statusTable, 0, 8, "Breakout", text_color=color.white)
    table.cell(statusTable, 1, 8, "6885 ‚ñ≤", bgcolor=color.new(color.lime, 80), text_color=color.black)
    
    // Distance to key levels
    distTo6865 = level4 - close
    distTo6865Str = distTo6865 > 0 ? "-" + str.tostring(math.abs(distTo6865), "#.#") : "+" + str.tostring(math.abs(distTo6865), "#.#")
    table.cell(statusTable, 0, 9, "To üêãCCS 6865", text_color=color.white)
    table.cell(statusTable, 1, 9, distTo6865Str, bgcolor=color.new(color.fuchsia, 80), text_color=color.white)
    
    distTo6835 = level7 - close
    distTo6835Str = distTo6835 > 0 ? "-" + str.tostring(math.abs(distTo6835), "#.#") : "+" + str.tostring(math.abs(distTo6835), "#.#")
    table.cell(statusTable, 0, 10, "To Fri Close", text_color=color.white)
    table.cell(statusTable, 1, 10, distTo6835Str, bgcolor=color.new(color.yellow, 80), text_color=color.black)
    
    distTo6800 = level10 - close
    distTo6800Str = distTo6800 > 0 ? "-" + str.tostring(math.abs(distTo6800), "#.#") : "+" + str.tostring(math.abs(distTo6800), "#.#")
    table.cell(statusTable, 0, 11, "To üêãPCS 6800", text_color=color.white)
    table.cell(statusTable, 1, 11, distTo6800Str, bgcolor=color.new(color.fuchsia, 80), text_color=color.white)
    
    // Volume Status
    volStatus = volSpike ? "üî• SPIKE" : "Normal"
    volColor = volSpike ? color.orange : color.gray
    table.cell(statusTable, 0, 12, "Volume", text_color=color.white)
    table.cell(statusTable, 1, 12, volStatus, bgcolor=color.new(volColor, 70), text_color=color.white)
    
    // Market Context
    table.cell(statusTable, 0, 13, "Context", text_color=color.white)
    table.cell(statusTable, 1, 13, "üêã IC Whale Week", bgcolor=color.new(color.fuchsia, 80), text_color=color.white)
    
    table.cell(statusTable, 0, 14, "Whale Size", text_color=color.white)
    table.cell(statusTable, 1, 14, "15k->50k Wed", bgcolor=color.new(color.fuchsia, 80), text_color=color.white)
    
    table.cell(statusTable, 0, 15, "Upside", text_color=color.white)
    table.cell(statusTable, 1, 15, "6865->6885->6900", bgcolor=color.new(color.gray, 80), text_color=color.white)
    
    table.cell(statusTable, 0, 16, "Downside", text_color=color.white)
    table.cell(statusTable, 1, 16, "6835->6820->6815->6800", bgcolor=color.new(color.gray, 80), text_color=color.white)
    
    table.cell(statusTable, 0, 17, "V-Bounce", text_color=color.white)
    table.cell(statusTable, 1, 17, "6800 üîÑ", bgcolor=color.new(color.fuchsia, 80), text_color=color.white)

// === PLOT INVISIBLE LINES FOR ALERT TRIGGERS ===
plot(level1, "6900 ATH", color=color.new(color.lime, 100))
plot(level2, "6885 BO", color=color.new(color.lime, 100))
plot(level3, "6875 Chop Top", color=color.new(color.aqua, 100))
plot(level4, "6865 üêãCCS", color=color.new(color.fuchsia, 100))
plot(level5, "6860 GEX", color=color.new(color.yellow, 100))
plot(level6, "6850 Pivot", color=color.new(color.aqua, 100))
plot(level7, "6835 Fri Close", color=color.new(color.yellow, 100))
plot(level8, "6820 React", color=color.new(color.orange, 100))
plot(level9, "6815 Floor", color=color.new(color.orange, 100))
plot(level10, "6800 üêãPCS", color=color.new(color.fuchsia, 100))
plot(level_whale_put_long, "6795 üêãPCS Long", color=color.new(color.maroon, 100))

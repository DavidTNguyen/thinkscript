//@version=5
indicator("SPX Levels: Trading Bias & Structure", overlay=true, max_lines_count=500, max_labels_count=500)

// === SPX Levels: Trading Bias & Structure ===
// Updated: November 15, 2025
// 
// TRADING BIAS:
// Above 6635+ = No ðŸ» Bias, buy dips vs. ðŸ‚ Star
// Below 6880+ = No ðŸ‚ Bias, fade rallies vs. ðŸ» Star
// Trade W-shape swings until either boundary is broken on high volume
//
// SENTIMENT METER:
// 6635+ & above = Cautious ðŸ‚ - Dip buys allowed, scale out at intermediate strikes
// 6725-6765 = Neutral Chop - Scalps only, Greeks in play, both directions
// 6825-6880+ = ðŸ» Pressure - Short rallies, avoid breakout longs unless volume spike confirms
// Below 6635- = High ðŸ» - Swing shorts toward lower structure
//
// VISUAL RANGE MAP:
// Rally Continuation Zone
// 6880+ = ðŸ» Star (Major Short Zone) - MOST CRITICAL
// 6825 = Small ðŸ» Star
// 6765 = Intermediate Strike
// 6725 = "Greek Chase" Strike - Scalps only
// 6705 = Gap-Down Play Zone
// 6695 = Dead Volume Dip Buy Area
// 6635 = ðŸ‚ Star (Major Long Zone / Buy Support) - MOST CRITICAL
// 6620 = Lower Range Edge
// Breakdown = Waterfall Risk

// === INPUTS ===
// Resistance Levels
level1 = input.float(6880, "R1 - ðŸ» Star (Major Short Zone)", group="ðŸ”´ Resistance Levels")
level1_thickness = input.int(5, "R1 Line Thickness", minval=1, maxval=10, group="ðŸ”´ Resistance Levels")
level2 = input.float(6825, "R2 - Small ðŸ» Star", group="ðŸ”´ Resistance Levels")
level2_thickness = input.int(3, "R2 Line Thickness", minval=1, maxval=10, group="ðŸ”´ Resistance Levels")
level3 = input.float(6765, "R3 - Intermediate Strike", group="ðŸ”´ Resistance Levels")
level3_thickness = input.int(3, "R3 Line Thickness", minval=1, maxval=10, group="ðŸ”´ Resistance Levels")
level4 = input.float(6725, "R4 - Greek Chase (Scalps Only)", group="ðŸ”´ Resistance Levels")
level4_thickness = input.int(2, "R4 Line Thickness", minval=1, maxval=10, group="ðŸ”´ Resistance Levels")

// Neutral Zone
level5 = input.float(6705, "N1 - Gap-Down Play Zone", group="âšª Neutral Zone")
level5_thickness = input.int(2, "N1 Line Thickness", minval=1, maxval=10, group="âšª Neutral Zone")
level6 = input.float(6695, "N2 - Dead Volume Dip Buy", group="âšª Neutral Zone")
level6_thickness = input.int(2, "N2 Line Thickness", minval=1, maxval=10, group="âšª Neutral Zone")

// Support Levels
level7 = input.float(6635, "S1 - ðŸ‚ Star (Major Long Zone)", group="ðŸŸ¢ Support Levels")
level7_thickness = input.int(5, "S1 Line Thickness", minval=1, maxval=10, group="ðŸŸ¢ Support Levels")
level8 = input.float(6620, "S2 - Lower Range Edge", group="ðŸŸ¢ Support Levels")
level8_thickness = input.int(3, "S2 Line Thickness", minval=1, maxval=10, group="ðŸŸ¢ Support Levels")

// Alert Settings
enableAlerts = input.bool(true, "Enable Alerts", group="ðŸ”” Alert Settings")
alertSensitivity = input.float(0.5, "Alert Sensitivity", minval=0.1, maxval=5.0, group="ðŸ”” Alert Settings")

// Label Visibility
showLabels = input.bool(true, "Show Labels", group="ðŸ“Š Display Settings")
showLines = input.bool(true, "Show Level Lines", group="ðŸ“Š Display Settings")

// === RESISTANCE LINES ===
var line l1 = na
var line l2 = na
var line l3 = na
var line l4 = na
var line l5 = na
var line l6 = na
var line l7 = na
var line l8 = na

if showLines and barstate.islast
    // R1 - ðŸ» Star (Red, Heavy)
    l1 := line.new(bar_index - 100, level1, bar_index + 20, level1, color=color.red, width=level1_thickness, style=line.style_solid)
    
    // R2 - Small ðŸ» Star (Orange)
    l2 := line.new(bar_index - 100, level2, bar_index + 20, level2, color=color.orange, width=level2_thickness, style=line.style_solid)
    
    // R3 - Intermediate Strike (Yellow)
    l3 := line.new(bar_index - 100, level3, bar_index + 20, level3, color=color.yellow, width=level3_thickness, style=line.style_solid)
    
    // R4 - Greek Chase (Gray, Dashed)
    l4 := line.new(bar_index - 100, level4, bar_index + 20, level4, color=color.gray, width=level4_thickness, style=line.style_dashed)
    
    // N1 - Gap-Down Play (Cyan, Dashed)
    l5 := line.new(bar_index - 100, level5, bar_index + 20, level5, color=color.aqua, width=level5_thickness, style=line.style_dashed)
    
    // N2 - Dead Volume (Cyan)
    l6 := line.new(bar_index - 100, level6, bar_index + 20, level6, color=color.aqua, width=level6_thickness, style=line.style_solid)
    
    // S1 - ðŸ‚ Star (Green, Heavy)
    l7 := line.new(bar_index - 100, level7, bar_index + 20, level7, color=color.green, width=level7_thickness, style=line.style_solid)
    
    // S2 - Lower Range Edge (Magenta)
    l8 := line.new(bar_index - 100, level8, bar_index + 20, level8, color=color.fuchsia, width=level8_thickness, style=line.style_solid)

// === LABELS ===
if barstate.islast and showLabels
    label.new(bar_index, level1, "R1: 6880 - ðŸ» STAR (Major Short)", style=label.style_label_left, color=color.red, textcolor=color.white)
    label.new(bar_index, level2, "R2: 6825 - Small ðŸ» Star", style=label.style_label_left, color=color.orange, textcolor=color.white)
    label.new(bar_index, level3, "R3: 6765 - Intermediate Strike", style=label.style_label_left, color=color.yellow, textcolor=color.black)
    label.new(bar_index, level4, "R4: 6725 - Greek Chase (Scalps Only)", style=label.style_label_left, color=color.gray, textcolor=color.white)
    label.new(bar_index, level5, "N1: 6705 - Gap-Down Play", style=label.style_label_left, color=color.aqua, textcolor=color.black)
    label.new(bar_index, level6, "N2: 6695 - Dead Volume Dip Buy", style=label.style_label_left, color=color.aqua, textcolor=color.black)
    label.new(bar_index, level7, "S1: 6635 - ðŸ‚ STAR (Major Long)", style=label.style_label_right, color=color.green, textcolor=color.white)
    label.new(bar_index, level8, "S2: 6620 - Lower Range Edge", style=label.style_label_right, color=color.fuchsia, textcolor=color.white)

// === ALERT CONDITIONS ===

// CRITICAL: ðŸ» Star Alerts (6880 - MOST CRITICAL)
alertcondition(ta.crossover(close, level1), "ðŸ» Star Break", "SPX â¬†ï¸ 6880 - ðŸ» STAR BROKEN! ðŸ‚ BIAS ON!")
alertcondition(ta.crossunder(close, level1), "ðŸ» Star Reject", "SPX â¬‡ï¸ 6880 - NO ðŸ‚ BIAS! Fade rallies vs ðŸ» Star")
testingBearStar = close >= (level1 - alertSensitivity) and close <= (level1 + alertSensitivity)
alertcondition(testingBearStar, "Testing ðŸ» Star", "SPX Testing 6880 - ðŸ» STAR - Major Short Zone")
rejectionBearStar = high[1] >= level1 and close < level1 - 5
alertcondition(rejectionBearStar, "Rejection ðŸ» Star", "SPX REJECTION at 6880 - ðŸ» STAR HOLDS!")

// CRITICAL: ðŸ‚ Star Alerts (6635 - MOST CRITICAL)
alertcondition(ta.crossover(close, level7), "ðŸ‚ Star Hold", "SPX â¬†ï¸ 6635 - NO ðŸ» BIAS! Buy dips vs ðŸ‚ Star")
alertcondition(ta.crossunder(close, level7), "ðŸ‚ Star Break", "SPX â¬‡ï¸ 6635 - ðŸ‚ STAR BROKEN! HIGH ðŸ»!")
testingBullStar = close >= (level7 - alertSensitivity) and close <= (level7 + alertSensitivity)
alertcondition(testingBullStar, "Testing ðŸ‚ Star", "SPX Testing 6635 - ðŸ‚ STAR - Major Long Zone")
bounceBullStar = low[1] <= level7 and close > level7 + 5
alertcondition(bounceBullStar, "Bounce ðŸ‚ Star", "SPX BOUNCE from 6635 - ðŸ‚ STAR HOLDS!")

// Intermediate Resistance Alerts
alertcondition(ta.crossover(close, level2), "Small ðŸ» Break", "SPX â¬†ï¸ 6825 - Small ðŸ» Star broken")
alertcondition(ta.crossover(close, level3), "Intermediate Break", "SPX â¬†ï¸ 6765 - Intermediate Strike")
alertcondition(ta.crossover(close, level4), "Greek Chase Break", "SPX â¬†ï¸ 6725 - Greek Chase zone")

// Intermediate Support Alerts
alertcondition(ta.crossunder(close, level8), "Lower Range Break", "SPX â¬‡ï¸ 6620 - LOWER RANGE EDGE! Waterfall Risk!")
alertcondition(ta.crossunder(close, level6), "Dead Volume Break", "SPX â¬‡ï¸ 6695 - Dead Volume area")
alertcondition(ta.crossunder(close, level5), "Gap-Down Break", "SPX â¬‡ï¸ 6705 - Gap-Down play zone")

// Bounce/Rejection Alerts
rejectionSmallBear = high[1] >= level2 and close < level2 - 3
alertcondition(rejectionSmallBear, "Reject Small ðŸ»", "SPX REJECTION at 6825 - Small ðŸ» Star holds")
rejectionIntermediate = high[1] >= level3 and close < level3 - 3
alertcondition(rejectionIntermediate, "Reject Intermediate", "SPX REJECTION at 6765 - Intermediate Strike holds")
bounceDeadVolume = low[1] <= level6 and close > level6 + 3
alertcondition(bounceDeadVolume, "Bounce Dead Volume", "SPX BOUNCE from 6695 - Dip buy area holds")
bounceLowerRange = low[1] <= level8 and close > level8 + 3
alertcondition(bounceLowerRange, "Bounce Lower Range", "SPX BOUNCE from 6620 - Lower range edge holds")

// W-Shape Swing Alert
inWShapeZone = close >= level7 and close <= level1
alertcondition(inWShapeZone, "W-Shape Zone", "SPX IN W-SHAPE SWING ZONE (6635-6880) - Trade boundaries")

// === TABLE FOR STATUS ===
var table statusTable = table.new(position.top_right, 2, 12, border_width=1)

if barstate.islast and showLabels
    // Header
    table.cell(statusTable, 0, 0, "SPX LEVELS", bgcolor=color.new(color.blue, 70), text_color=color.white)
    table.cell(statusTable, 1, 0, str.tostring(close, "#.##"), bgcolor=color.new(color.blue, 70), text_color=color.white)
    
    // Alert Status
    table.cell(statusTable, 0, 1, "Alerts", text_color=color.white)
    table.cell(statusTable, 1, 1, enableAlerts ? "ON" : "OFF", bgcolor=enableAlerts ? color.green : color.red, text_color=color.white)
    
    // Critical Levels
    table.cell(statusTable, 0, 2, "ðŸ» Star: 6880 | ðŸ‚ Star: 6635", text_color=color.white)
    table.cell(statusTable, 1, 2, "CRITICAL", bgcolor=color.new(color.orange, 70), text_color=color.white)
    
    // Trading Bias
    tradingBias = close > level1 ? "â¬†ï¸ 6880 - ðŸ‚ BIAS" : close >= level7 and close <= level1 ? "W-SHAPE SWING" : "â¬‡ï¸ 6635 - HIGH ðŸ»"
    biasColor = close > level1 ? color.green : close >= level7 ? color.yellow : color.red
    table.cell(statusTable, 0, 3, "Trading Bias", text_color=color.white)
    table.cell(statusTable, 1, 3, tradingBias, bgcolor=color.new(biasColor, 70), text_color=color.white)
    
    // Sentiment
    sentiment = close >= level7 ? "Cautious ðŸ‚" : close >= level4 and close < level3 ? "Neutral Chop" : close >= level2 and close < level1 ? "ðŸ» Pressure" : "High ðŸ»"
    sentimentColor = close >= level7 ? color.green : close >= level4 and close < level3 ? color.yellow : close >= level2 ? color.orange : color.red
    table.cell(statusTable, 0, 4, "Sentiment", text_color=color.white)
    table.cell(statusTable, 1, 4, sentiment, bgcolor=color.new(sentimentColor, 70), text_color=color.white)
    
    // Action
    action = close >= level7 ? "Dip buys allowed" : close >= level4 and close < level3 ? "Scalps only" : close >= level2 ? "Short rallies" : "Swing shorts"
    table.cell(statusTable, 0, 5, "Action", text_color=color.white)
    table.cell(statusTable, 1, 5, action, bgcolor=color.new(sentimentColor, 70), text_color=color.white)
    
    // Distance to ðŸ» Star
    distToBearStar = level1 - close
    table.cell(statusTable, 0, 6, "-> ðŸ» Star", text_color=color.white)
    table.cell(statusTable, 1, 6, str.tostring(distToBearStar, "#.#"), bgcolor=color.new(color.red, 80), text_color=color.white)
    
    // Distance from ðŸ‚ Star
    distFromBullStar = close - level7
    distFromBullStr = distFromBullStar > 0 ? "+" + str.tostring(distFromBullStar, "#.#") : str.tostring(distFromBullStar, "#.#")
    distFromBullColor = distFromBullStar > 0 ? color.new(color.green, 80) : color.new(color.red, 80)
    table.cell(statusTable, 0, 7, "From ðŸ‚ Star", text_color=color.white)
    table.cell(statusTable, 1, 7, distFromBullStr, bgcolor=distFromBullColor, text_color=color.white)
    
    // Zone Status
    zoneStatus = close >= level1 - 5 and close <= level1 + 5 ? "NEAR ðŸ» STAR!" : close >= level7 - 5 and close <= level7 + 5 ? "NEAR ðŸ‚ STAR!" : close >= level4 and close <= level4 + 10 ? "Greek Chase" : close >= level6 and close <= level5 ? "Dead Volume" : close < level8 ? "WATERFALL RISK!" : "In Range"
    zoneColor = close >= level1 - 5 and close <= level1 + 5 ? color.red : close >= level7 - 5 and close <= level7 + 5 ? color.green : close >= level4 and close <= level4 + 10 ? color.gray : close >= level6 and close <= level5 ? color.aqua : close < level8 ? color.fuchsia : color.yellow
    table.cell(statusTable, 0, 8, "Zone", text_color=color.white)
    table.cell(statusTable, 1, 8, zoneStatus, bgcolor=color.new(zoneColor, 70), text_color=color.white)

// === PLOT INVISIBLE LINES FOR ALERT TRIGGERS ===
plot(level1, "ðŸ» Star", color=color.new(color.red, 100))
plot(level7, "ðŸ‚ Star", color=color.new(color.green, 100))
plot(level2, "Small ðŸ»", color=color.new(color.orange, 100))
plot(level8, "Lower Range", color=color.new(color.fuchsia, 100))
